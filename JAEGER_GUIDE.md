# üîç Jaeger - Distributed Tracing

## –ß—Ç–æ —ç—Ç–æ?

**Jaeger** - —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.

## üìä –ß—Ç–æ –≤—ã —É–≤–∏–¥–∏—Ç–µ

### 1. –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞
```
User Request
  ‚îî‚îÄ api-gateway (5ms)
      ‚îî‚îÄ shortener-service (10ms)
          ‚îî‚îÄ Redis (2ms)
```

### 2. –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏
- –û–±—â–µ–µ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞: 17ms
- –í—Ä–µ–º—è –≤ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–∏—Å–µ
- –í—Ä–µ–º—è –Ω–∞ I/O –æ–ø–µ—Ä–∞—Ü–∏–∏ (Redis, MongoDB, Kafka)

### 3. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
```
Redirect Request
  ‚îî‚îÄ redirect-service (3ms)
      ‚îú‚îÄ Redis GET (1ms)
      ‚îî‚îÄ Kafka Publish (async)
          ‚îî‚îÄ analytics-service (5ms)
              ‚îî‚îÄ MongoDB INSERT (2ms)
```

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### –ó–∞–ø—É—Å–∫

Jaeger —É–∂–µ –≤–∫–ª—é—á—ë–Ω –≤ docker-compose:

```bash
docker-compose up -d
```

### –û—Ç–∫—Ä—ã—Ç—å UI

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: **http://localhost:16686**

### –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç—Ä–µ–π—Å–æ–≤

1. **–í—ã–±–µ—Ä–∏—Ç–µ —Å–µ—Ä–≤–∏—Å** –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞:
   - `api-gateway`
   - `shortener-service`
   - `redirect-service`
   - `analytics-service`

2. **–ù–∞–∂–º–∏—Ç–µ "Find Traces"**

3. **–ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ —Ç—Ä–µ–π—Å** —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–µ—Ç–∞–ª–∏

## üìñ –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### Trace (–¢—Ä–µ–π—Å)
–ü–æ–ª–Ω—ã–π –ø—É—Ç—å –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ –≤—Å—é —Å–∏—Å—Ç–µ–º—É.

### Span (–°–ø–∞–Ω)
–û–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–µ–π—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, HTTP –∑–∞–ø—Ä–æ—Å –∏–ª–∏ –∑–∞–ø–∏—Å—å –≤ –ë–î).

### Tags (–¢–µ–≥–∏)
–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–ø–∞–Ω–∞:
- `http.method=POST`
- `http.status_code=200`
- `db.type=redis`

### Logs (–õ–æ–≥–∏)
–°–æ–±—ã—Ç–∏—è –≤–Ω—É—Ç—Ä–∏ —Å–ø–∞–Ω–∞ —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–∫–∞–º–∏.

## üîç –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –û—Ç–ª–∞–¥–∫–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ—Ä–æ—Ç–∫–∏—Ö URL
2. –û—Ç–∫—Ä–æ–π—Ç–µ Jaeger UI
3. –ù–∞–π–¥–∏—Ç–µ –º–µ–¥–ª–µ–Ω–Ω—ã–π —Ç—Ä–µ–π—Å
4. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫–æ–π —Å–µ—Ä–≤–∏—Å —Ç–æ—Ä–º–æ–∑–∏—Ç

**–ß—Ç–æ –∏—Å–∫–∞—Ç—å:**
- –ë–æ–ª—å—à–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–º–µ–∂—É—Ç–∫–∏ –º–µ–∂–¥—É —Å–ø–∞–Ω–∞–º–∏
- –î–æ–ª–≥–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –ë–î
- –°–µ—Ç–µ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü–æ–∏—Å–∫ –æ—à–∏–±–æ–∫

1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –∑–∞–ø—Ä–æ—Å
2. –í Jaeger –Ω–∞–π–¥–∏—Ç–µ —Ç—Ä–µ–π—Å—ã —Å –æ—à–∏–±–∫–∞–º–∏ (–∫—Ä–∞—Å–Ω—ã–µ)
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –Ω–∞ –∫–∞–∫–æ–º —Å–µ—Ä–≤–∏—Å–µ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞
4. –ò–∑—É—á–∏—Ç–µ —Ç–µ–≥–∏ –∏ –ª–æ–≥–∏ –¥–ª—è –¥–µ—Ç–∞–ª–µ–π

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–æ–∫–∞

1. –°–æ–∑–¥–∞–π—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–π URL
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ –Ω–µ–º—É –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
4. –í Jaeger –Ω–∞–π–¥–∏—Ç–µ –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç—Ä–µ–π—Å—ã

**–í—ã —É–≤–∏–¥–∏—Ç–µ:**
- –°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫: `api-gateway ‚Üí shortener-service ‚Üí Redis`
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–æ—Ç–æ–∫: `redirect-service ‚Üí Kafka ‚Üí analytics-service ‚Üí MongoDB`

## üéØ –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã

### –ü–æ —Å–µ—Ä–≤–∏—Å—É
```
service=api-gateway
```

### –ü–æ –æ–ø–µ—Ä–∞—Ü–∏–∏
```
operation=POST /api/shorten
```

### –ü–æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
```
minDuration=100ms
```

### –ü–æ —Ç–µ–≥–∞–º
```
http.status_code=500
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –∫–æ—Ç–æ—Ä—ã–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ

### Latency (–ó–∞–¥–µ—Ä–∂–∫–∞)
- P50 (–º–µ–¥–∏–∞–Ω–∞): 50% –∑–∞–ø—Ä–æ—Å–æ–≤ –±—ã—Å—Ç—Ä–µ–µ —ç—Ç–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
- P95: 95% –∑–∞–ø—Ä–æ—Å–æ–≤ –±—ã—Å—Ç—Ä–µ–µ
- P99: 99% –∑–∞–ø—Ä–æ—Å–æ–≤ –±—ã—Å—Ç—Ä–µ–µ

### Throughput (–ü—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å)
- Requests per second
- Requests per minute

### Error Rate (–ü—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ–∫)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ failed spans
- –ü—Ä–æ—Ü–µ–Ω—Ç —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç—Ä–µ–π—Å–∏–Ω–≥–∞

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **Instrumentation**
   - –ö–∞–∂–¥—ã–π —Å–µ—Ä–≤–∏—Å —Å–æ–∑–¥–∞—ë—Ç spans –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π
   - Spans —Å–æ–¥–µ—Ä–∂–∞—Ç timing –∏ metadata

2. **Context Propagation**
   - Trace ID –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ HTTP headers
   - –í—Å–µ spans –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∏–º–µ—é—Ç –æ–¥–∏–Ω Trace ID

3. **Collection**
   - Spans –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Jaeger Agent (UDP 6831)
   - Agent –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ Jaeger Collector

4. **Storage**
   - –¢—Ä–µ–π—Å—ã —Ö—Ä–∞–Ω—è—Ç—Å—è in-memory (–≤ all-in-one —Ä–µ–∂–∏–º–µ)
   - –î–ª—è production –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Cassandra –∏–ª–∏ Elasticsearch

5. **Query**
   - UI –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ Jaeger Query API
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã Jaeger

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Jaeger Agent   ‚îÇ ‚Üê –ü—Ä–∏–Ω–∏–º–∞–µ—Ç spans –æ—Ç —Å–µ—Ä–≤–∏—Å–æ–≤ (UDP)
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Jaeger Collector‚îÇ ‚Üê –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Jaeger Storage ‚îÇ ‚Üê In-memory / Cassandra / ES
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Jaeger Query   ‚îÇ ‚Üê API –¥–ª—è UI
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   Jaeger UI     ‚îÇ ‚Üê http://localhost:16686
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üåê –ü–æ—Ä—Ç—ã Jaeger

| –ü–æ—Ä—Ç | –ü—Ä–æ—Ç–æ–∫–æ–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|----------|------------|
| 5775 | UDP | zipkin.thrift |
| 6831 | UDP | jaeger.thrift compact (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å–∞–º–∏) |
| 6832 | UDP | jaeger.thrift binary |
| 5778 | HTTP | Serve configs |
| 16686 | HTTP | **Web UI** ‚≠ê |
| 14268 | HTTP | Collector API |
| 14250 | gRPC | Collector gRPC |
| 9411 | HTTP | Zipkin compatible endpoint |

## üí° Tips & Tricks

### 1. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç—Ä–µ–π—Å–æ–≤
- –û—Ç–∫—Ä–æ–π—Ç–µ –¥–≤–∞ —Ç—Ä–µ–π—Å–∞ –≤ —Ä–∞–∑–Ω—ã—Ö –≤–∫–ª–∞–¥–∫–∞—Ö
- –°—Ä–∞–≤–Ω–∏—Ç–µ timing
- –ù–∞–π–¥–∏—Ç–µ –∞–Ω–æ–º–∞–ª–∏–∏

### 2. –ü–æ–∏—Å–∫ –ø–æ trace ID
- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ Trace ID –∏–∑ –ª–æ–≥–æ–≤
- –í—Å—Ç–∞–≤—å—Ç–µ –≤ Jaeger UI
- –ù–∞–π–¥–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å

### 3. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –æ–ø–µ—Ä–∞—Ü–∏—è–º
- –°–º–æ—Ç—Ä–∏—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ endpoint'–∞–º
- –ù–∞—Ö–æ–¥–∏—Ç–µ —Å–∞–º—ã–µ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### 4. Timeline view
- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –í–∏–¥–Ω–æ, —á—Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

## üêõ Troubleshooting

### –ù–µ –≤–∏–¥–Ω–æ —Ç—Ä–µ–π—Å–æ–≤

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
1. Jaeger –∑–∞–ø—É—â–µ–Ω: `docker-compose ps jaeger`
2. –°–µ—Ä–≤–∏—Å—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç –¥–∞–Ω–Ω—ã–µ: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
3. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—Ä–µ–º–µ–Ω–Ω–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω –≤ UI

### –ù–µ–ø–æ–ª–Ω—ã–µ —Ç—Ä–µ–π—Å—ã

**–ü—Ä–∏—á–∏–Ω—ã:**
- –°–µ—Ä–≤–∏—Å –Ω–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω (–Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω OpenTelemetry –∫–æ–¥)
- Context –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
- Spans –Ω–µ flush'–∞—Ç—Å—è (–Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è)

### Jaeger UI –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker logs url-shortener-jaeger

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose restart jaeger
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Jaeger Documentation](https://www.jaegertracing.io/docs/)
- [OpenTelemetry](https://opentelemetry.io/)
- [Distributed Tracing Best Practices](https://www.jaegertracing.io/docs/latest/best-practices/)

## üéì –ß—Ç–æ –∏–∑—É—á–∏—Ç—å –¥–∞–ª—å—à–µ

1. **Sampling Strategies**
   - Probabilistic (–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã–π)
   - Rate limiting
   - Adaptive sampling

2. **Production Setup**
   - Separate Jaeger components
   - Persistent storage (Cassandra/Elasticsearch)
   - High availability

3. **Advanced Instrumentation**
   - Custom spans
   - Span events
   - Baggage (–∫–æ–Ω—Ç–µ–∫—Å—Ç –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏)

4. **Integration**
   - Prometheus metrics
   - Grafana dashboards
   - Alerting –Ω–∞ –±–∞–∑–µ —Ç—Ä–µ–π—Å–æ–≤

---

**–ê–≤—Ç–æ—Ä:** URL Shortener Demo  
**–í–µ—Ä—Å–∏—è:** 1.0 with Jaeger  

–ü—Ä–∏—è—Ç–Ω–æ–≥–æ —Ç—Ä–µ–π—Å–∏–Ω–≥–∞! üîç
