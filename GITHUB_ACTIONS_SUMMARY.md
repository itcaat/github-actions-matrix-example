# üéØ GitHub Actions CI/CD - Summary

## ‚úÖ –°–æ–∑–¥–∞–Ω–æ 3 workflow —Ñ–∞–π–ª–∞

### 1. `.github/workflows/build-pr.yml` - Build Pull Request
**–¢—Ä–∏–≥–≥–µ—Ä:** Pull Request –≤ main, manual dispatch

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –º–∞—Ç—Ä–∏—Ü–∞** - —Å–æ–±–∏—Ä–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- ‚úÖ **–£–º–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ** - –µ—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª—Å—è `pkg/`, –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç –≤—Å–µ Go —Å–µ—Ä–≤–∏—Å—ã
- ‚úÖ **–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ PR** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ–±—Ä–∞–∑–∞—Ö
- ‚úÖ **–¢–µ–≥–∏:** `pr-{number}`, `pr-{number}-{sha}`

**–ü—Ä–∏–º–µ—Ä:**
```yaml
# –ò–∑–º–µ–Ω–∏–ª—Å—è api-gateway ‚Üí —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ api-gateway
# –ò–∑–º–µ–Ω–∏–ª—Å—è pkg/tracing ‚Üí —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –≤—Å–µ 4 Go —Å–µ—Ä–≤–∏—Å–∞
```

### 2. `.github/workflows/build-main.yml` - Build Main
**–¢—Ä–∏–≥–≥–µ—Ä:** Push –≤ main, manual dispatch

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–±–æ—Ä–∫–∞** –ø–æ—Å–ª–µ –º–µ—Ä–∂–∞ PR
- ‚úÖ **Production —Ç–µ–≥–∏:** `latest`, `main`, `main-{sha}`
- ‚úÖ **–¢–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã** –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Å–±–æ—Ä–∫–∏

### 3. `.github/workflows/build-all.yml` - Build All Services
**–¢—Ä–∏–≥–≥–µ—Ä:** –¢–æ–ª—å–∫–æ manual dispatch

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- ‚úÖ **–°–±–æ—Ä–∫–∞ –≤—Å–µ—Ö 5 —Å–µ—Ä–≤–∏—Å–æ–≤** –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- ‚úÖ **–ö–∞—Å—Ç–æ–º–Ω—ã–π —Ç–µ–≥** —á–µ—Ä–µ–∑ input –ø–∞—Ä–∞–º–µ—Ç—Ä
- ‚úÖ **–ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞** –¥–ª—è release/testing

## üéÅ –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### 1. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –º–∞—Ç—Ä–∏—Ü–∞ (–∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ)**
```bash
# –ù–∞—Ö–æ–¥–∏–º –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
find . -name "Dockerfile" ‚Üí ["api-gateway", "shortener-service", ...]
   ‚Üì
# –§–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–º
changed-files ‚Üí ["api-gateway", "pkg"]
   ‚Üì
# –ï—Å–ª–∏ pkg/ –∏–∑–º–µ–Ω–∏–ª—Å—è ‚Üí –≤—Å–µ Go —Å–µ—Ä–≤–∏—Å—ã
matrix: { service: ["api-gateway", "shortener-service", "redirect-service", "analytics-service"] }
   ‚Üì
–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å workflow –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –Ω–∞–ª–∏—á–∏—é Dockerfile
- ‚úÖ –£–º–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### 2. **–£–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏**
```bash
# –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ò–∑–º–µ–Ω–∏–ª—Å—è api-gateway/main.go
‚Üí –°–æ–±–∏—Ä–∞–µ—Ç—Å—è: api-gateway

# –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ò–∑–º–µ–Ω–∏–ª—Å—è pkg/tracing/tracing.go
‚Üí –°–æ–±–∏—Ä–∞—é—Ç—Å—è: api-gateway, shortener-service, redirect-service, analytics-service

# –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ò–∑–º–µ–Ω–∏–ª–∏—Å—å api-gateway/ –∏ frontend/
‚Üí –°–æ–±–∏—Ä–∞—é—Ç—Å—è: api-gateway, frontend

# –°—Ü–µ–Ω–∞—Ä–∏–π 4: –î–æ–±–∞–≤–∏–ª–∏ –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å new-service/ —Å Dockerfile
‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –º–∞—Ç—Ä–∏—Ü—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
```

### 3. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è**
```yaml
cache-from: type=gha,scope=${{ matrix.service }}
cache-to: type=gha,mode=max,scope=${{ matrix.service }}
```
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–±–æ—Ä–∫–∏ –Ω–∞ 50-80%

### 4. **GitHub Container Registry**
–í—Å–µ –æ–±—Ä–∞–∑—ã –ø—É–±–ª–∏–∫—É—é—Ç—Å—è –≤ GHCR:
```
ghcr.io/itcaat/url-shortener-demo/
‚îú‚îÄ‚îÄ api-gateway:latest
‚îú‚îÄ‚îÄ api-gateway:pr-123
‚îú‚îÄ‚îÄ shortener-service:latest
‚îú‚îÄ‚îÄ redirect-service:latest
‚îú‚îÄ‚îÄ analytics-service:latest
‚îî‚îÄ‚îÄ frontend:latest
```

## üìä Workflow –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

| –°—Ü–µ–Ω–∞—Ä–∏–π | Workflow | –ß—Ç–æ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è | –¢–µ–≥–∏ |
|----------|----------|----------------|------|
| –°–æ–∑–¥–∞–ª PR —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –≤ api-gateway | `build-pr.yml` | api-gateway | pr-123 |
| –ò–∑–º–µ–Ω–∏–ª pkg/tracing –≤ PR | `build-pr.yml` | –≤—Å–µ Go —Å–µ—Ä–≤–∏—Å—ã (4 —à—Ç) | pr-123 |
| –ú–µ—Ä–¥–∂ PR –≤ main | `build-main.yml` | –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã | latest, main |
| –ù—É–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –≤—Å–µ –¥–ª—è release | `build-all.yml` | –≤—Å–µ 5 —Å–µ—Ä–≤–∏—Å–æ–≤ | v1.0.0, latest |

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Permissions
```yaml
permissions:
  contents: read        # –ß—Ç–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
  packages: write       # –ó–∞–ø–∏—Å—å –≤ GHCR
  pull-requests: write  # –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ PR (—Ç–æ–ª—å–∫–æ PR workflow)
```

### Registry
```yaml
env:
  REGISTRY: ghcr.io
  IMAGE_PREFIX: ${{ github.repository }}  # itcaat/url-shortener-demo
```

### Build Context
```yaml
with:
  context: .                              # –ö–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞
  file: ${{ matrix.service }}/Dockerfile  # Dockerfile —Å–µ—Ä–≤–∏—Å–∞
```

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 1. –°–æ–∑–¥–∞–Ω–∏–µ PR
```bash
# 1. –°–æ–∑–¥–∞–µ—Ç–µ –≤–µ—Ç–∫—É
git checkout -b feature/add-metrics

# 2. –í–Ω–æ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ api-gateway
vim api-gateway/main.go

# 3. –ö–æ–º–º–∏—Ç–∏—Ç–µ –∏ –ø—É—à–∏—Ç–µ
git commit -am "feat(api-gateway): add metrics endpoint"
git push origin feature/add-metrics

# 4. –°–æ–∑–¥–∞–µ—Ç–µ PR –Ω–∞ GitHub
# ‚Üí GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–µ—Ä–µ—Ç api-gateway
# ‚Üí –î–æ–±–∞–≤–∏—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å –æ–±—Ä–∞–∑–æ–º: ghcr.io/itcaat/url-shortener-demo/api-gateway:pr-123
```

### 2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞ –∏–∑ PR
```bash
# Pull –æ–±—Ä–∞–∑–∞ –∏–∑ PR
docker pull ghcr.io/itcaat/url-shortener-demo/api-gateway:pr-123

# –ó–∞–ø—É—Å–∫ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
docker run -p 3000:3000 ghcr.io/itcaat/url-shortener-demo/api-gateway:pr-123
```

### 3. –ü–æ—Å–ª–µ –º–µ—Ä–∂–∞
```bash
# PR –º–µ—Ä–∂–∏—Ç—Å—è –≤ main
# ‚Üí GitHub Actions —Å–æ–±–∏—Ä–∞–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
# ‚Üí –ü—É—à–∏—Ç —Å —Ç–µ–≥–∞–º–∏ latest, main

# –î–µ–ø–ª–æ–π production –æ–±—Ä–∞–∑–∞
docker pull ghcr.io/itcaat/url-shortener-demo/api-gateway:latest
```

### 4. –†—É—á–Ω–∞—è —Å–±–æ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
```bash
# –ù–∞ GitHub: Actions ‚Üí Build All Services ‚Üí Run workflow
# Tag: v1.0.0

# –†–µ–∑—É–ª—å—Ç–∞—Ç:
# ghcr.io/itcaat/url-shortener-demo/api-gateway:v1.0.0
# ghcr.io/itcaat/url-shortener-demo/shortener-service:v1.0.0
# ... –∏ —Ç.–¥.
```

## üìù –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ **[CI_CD.md](./CI_CD.md)**:
- –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ workflow
- –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- Troubleshooting
- Best practices

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ **Workflows —Å–æ–∑–¥–∞–Ω—ã** - –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
2. üîÑ **–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π PR** - –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–±–æ—Ä–∫—É
3. üì¶ **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ GHCR** - —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ packages –ø—É–±–ª–∏—á–Ω—ã–µ/–ø—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–∞–∫ –Ω—É–∂–Ω–æ
4. üöÄ **–ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å –¥–µ–ø–ª–æ–µ–º** - –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –æ–±—Ä–∞–∑—ã –¥–ª—è CD

## üí° –ë–æ–Ω—É—Å—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ PR
–ü—Ä–∏ —Å–±–æ—Ä–∫–µ –≤ PR –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:

```
‚úÖ api-gateway successfully built!

Images:
ghcr.io/itcaat/url-shortener-demo/api-gateway:pr-123
ghcr.io/itcaat/url-shortener-demo/api-gateway:pr-123-abc1234

Pull command:
docker pull ghcr.io/itcaat/url-shortener-demo/api-gateway:pr-123
```

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞
–ï—Å–ª–∏ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å 3 —Å–µ—Ä–≤–∏—Å–∞ - –æ–Ω–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ**:
```
api-gateway     ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ ‚úÖ 3m 45s
shortener-svc   ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ ‚úÖ   3m 12s  
frontend        ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ ‚úÖ       2m 30s
```

### GitHub Actions Cache
–ü–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–±–æ—Ä–∫–∏ –≤ **3-5 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ** –±–ª–∞–≥–æ–¥–∞—Ä—è –∫—ç—à—É:
```
1st build:  5m 30s
2nd build:  1m 45s (–∫—ç—à —Å–ª–æ–µ–≤)
3rd build:  1m 20s (–ø–æ–ª–Ω—ã–π –∫—ç—à)
```

---

**üéâ CI/CD –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!**

